import{j as s,r as m}from"./vendor-BcNuLXi4.js";const ns="gemini-2.5-flash",as="gemini-2.5-flash-lite",rs="gemma-3-27b-it",os="gemma-3n-e4b-it",is=.8,ls=10,cs=15,ms=30,hs=30,te=["Fantasy & Myth","Science Fiction & Future","Horror & Dark Mystery","Action & Wasteland","Testing"],ps=3,ds=3,us=50,gs="Eliot the Cougar",xs="1.5.0 (Backstory)",fs="10",vs="whispersInTheDark_gameState",js="whispersInTheDark_debugPacket",ws="whispersInTheDark_debugLore",bs="whispersInTheDark_geminiApiKey",Ss="whispersInTheDark_settings",Is=te.filter(e=>e!=="Testing"),Cs="player",ys="player_journal",Ts=6,Ns=70,_s=2,Es=5,Ls=3,Rs=3,As=2,Ds=1,Ms=5,Os=10,ks=10,$s=4,Us=10,B=["page","book","picture","map"],Gs=B.map(e=>e).join(", "),W=["single-use","multi-use","equipment","container","key","weapon","ammunition","vehicle","immovable","status effect"],Js=W.map(e=>e).join(", "),ne=[...W,...B],zs=ne.map(e=>e).join(", "),ae=["create","change","move","destroy","addDetails"],Vs=ae.map(e=>e).join(", "),Y=["default","junk"],re=["stashed"],C=["printed","handwritten","typed","digital"],oe=["faded","smudged","torn","glitching","encrypted","foreign","gothic","runic","recovered"],U=[...C,...oe],ie=[...Y,...re,...U],Fs=Y.map(e=>e).join(", "),qs=C.map(e=>e).join(", "),Hs=U.map(e=>e).join(", ");ie.map(e=>e).join(", ");const le=["inspect","use","drop","discard","enter","park","read","write"],Bs=le.map(e=>e).join(", "),ce=["distant","nearby","companion","unknown"],Ws=ce.map(e=>e).join(", "),Ys={1:"exposition - Introduces the setting, central characters, and the primary conflict of the tale.",2:"rising action - Tension and complications mount as the protagonist pursues their goal.",3:"climax - The story reaches a turning point where the protagonist confronts the core challenge.",4:"falling action - The immediate consequences of the climax unfold and loose ends are addressed.",5:"resolution - Conflicts resolve and the narrative ties up remaining threads for closure."},Xs={storyteller:{text:"Dungeon Master thinks...",icon:"░"},map:{text:"Cartographer draws the map...",icon:"░"},correction:{text:"Dungeon Master is fixing mistakes...",icon:"▓"},inventory:{text:"Dungeon Master handles items...",icon:"░"},librarian:{text:"Dungeon Master handles books...",icon:"░"},dialogue_turn:{text:"Conversation continues...",icon:"░"},dialogue_summary:{text:"Dialogue concludes...",icon:"░"},dialogue_memory_creation:{text:"Memories form...",icon:"░"},dialogue_conclusion_summary:{text:"Returning to the world...",icon:"░"},initial_load:{text:"Loading...",icon:"░"},visualize:{text:"Visualizing the scene...",icon:"░"},page:{text:"Reading...",icon:"░"},journal:{text:"Writing...",icon:"░"},loremaster_collect:{text:"Loremaster picks facts...",icon:"░"},loremaster_extract:{text:"Loremaster extracts new lore...",icon:"░"},loremaster_write:{text:"Loremaster writes down lore...",icon:"░"},loremaster_refine:{text:"Loremaster refines lore...",icon:"░"},book:{text:"Reading...",icon:"░"}},me=["undiscovered","discovered","rumored","quest_target","blocked"],Ks=me.map(e=>e).join(", "),X=["region","location","settlement","district","exterior","interior","room","feature"],Qs=X.map(e=>e).join(", "),Zs=X.reduce((e,t,o)=>(e[t]=o,e),{}),he=["path","road","sea route","door","teleporter","secret_passage","river_crossing","temporary_bridge","boarding_hook","shortcut"],Ps=he.map(e=>e).join(", "),pe=["open","accessible","closed","locked","blocked","hidden","rumored","one_way","collapsed","removed","active","inactive"],et=pe.map(e=>e).join(", "),st=["collapsed","hidden","removed"],tt=20,F=1e3,q=750,nt=`${String(-F/2)} ${String(-q/2)} ${String(F)} ${String(q)}`,at=8,rt=4,ot=10,it=1.1,lt=2,ct=.3,mt=5,ht=4,pt=8,dt=10,ut="a short creative description of the location, <300 chars",gt="a short creative description, focusing of travel conditions of the path",xt="alternative names, partial names, shorthands. Avoid generic common terms.";function G(e){const t=globalThis;return typeof t.structuredClone=="function"?t.structuredClone(e):k(e)}function M(e){const t=G(e);return t.inventory=t.inventory.map(o=>{var n;return{...o,chapters:(n=o.chapters)==null?void 0:n.map(a=>({...a,imageData:void 0}))}}),t.playerJournal=t.playerJournal.map(o=>({...o,imageData:void 0})),t}function k(e){if(e===null||typeof e!="object")return e;if(e instanceof Date)return new Date(e.getTime());if(Array.isArray(e))return e.map(o=>k(o));const t={};for(const o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=k(e[o]));return t}const de=e=>{let t=e.trim();const n=/^```(?:json)?\s*\n?(.*?)\n?\s*```$/s.exec(t);return n!=null&&n[1]&&(t=n[1].trim()),t};function K(e,t){try{const o=JSON.parse(e);return t&&!t(o)?null:o}catch{return null}}function ft(e){return Object.fromEntries(Object.entries(e).map(([o,n])=>[o,n===null?void 0:n]))}const T=e=>{const t=[];return e.minItems!==void 0&&t.push(`minItems ${String(e.minItems)}`),e.maxItems!==void 0&&t.push(`maxItems ${String(e.maxItems)}`),e.minLength!==void 0&&t.push(`minLength ${String(e.minLength)}`),e.maxLength!==void 0&&t.push(`maxLength ${String(e.maxLength)}`),e.description&&t.push(e.description),t.length?` /* ${t.join(". ")} */`:""},$=(e,t=0)=>{const o="  ".repeat(t);if(e.type==="object"||e.properties){const n=[`${o}{`],a=e.properties??{},l=new Set(e.required??[]),r=Object.keys(a);return r.forEach((c,p)=>{const h=$(a[c],t+1),v=h[0].trim().startsWith("{")||h[0].trim().startsWith("[");h[0]=v?`${o}  "${c}"${l.has(c)?"":"?"}:
${h[0]}`:`${o}  "${c}"${l.has(c)?"":"?"}: ${h[0]}`;const g=p<r.length-1?",":"";h[h.length-1]+=g,n.push(...h)}),n.push(`${o}}${T(e)}`),n}if(e.type==="array"||e.items){const n=[`${o}[`],a=$(e.items??{},t+1);return n.push(...a),n.push(`${o}]${T(e)}`),n}return e.enum?[`${e.enum.map(a=>JSON.stringify(a)).join(" | ")}${T(e)}`]:e.const!==void 0?[`${JSON.stringify(e.const)}${T(e)}`]:e.type?[`"${e.type==="integer"?"number":e.type}"${T(e)}`]:[`unknown${T(e)}`]},ue=e=>$(e).join(`
`),N=e=>{const o=(typeof e=="string"?K(e):e)??{};return`Respond ONLY with a JSON with the following schema:
${ue(o)}`},ge=(e,t)=>{const o=document.querySelector(".highlight-tooltip");o&&o.remove();const n=document.createElement("div");n.className="highlight-tooltip",n.textContent=e,document.body.appendChild(n);const a=8,l=t.left+t.width/2-n.offsetWidth/2+window.scrollX,r=t.bottom+a+window.scrollY;n.style.left=`${String(Math.max(4,Math.min(l,window.innerWidth-n.offsetWidth-4)))}px`,n.style.top=`${String(r)}px`;const c=()=>{n.remove(),document.removeEventListener("click",p)},p=h=>{n.contains(h.target)||c()};setTimeout(()=>{document.addEventListener("click",p)},0)};let L=null;const xe=e=>{const t=JSON.stringify(e.map(r=>({name:r.name,aliases:r.aliases??[],type:r.type})).sort((r,c)=>r.name.localeCompare(c.name)));if(L&&L.key===t)return L.value;const o=new Map;e.forEach(r=>{const c=(h,v)=>{if(h&&h.trim()!==""){const g=h.toLowerCase();o.has(g)||o.set(g,{term:v,entityData:r})}};c(r.name,r.name),(r.aliases??[]).forEach(h=>{c(h,h)});const p=r.name.toLowerCase();if(p.startsWith("the ")&&r.name.length>4){const h=r.name.substring(4);c(h,h)}else if(p.startsWith("a ")&&r.name.length>2){const h=r.name.substring(2);c(h,h)}});const n=Array.from(o.values());if(n.sort((r,c)=>c.term.length-r.term.length),n.length===0)return null;const a=n.map(r=>r.term.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).filter(r=>r.length>0).join("|");if(!a)return null;const l={regex:new RegExp(`\\b(${a})\\b`,"gi"),lookup:new Map(n.map(r=>[r.term.toLowerCase(),r]))};return L={key:t,value:l},l},fe=e=>{switch(e){case"item":return"font-semibold text-amber-400 hover:text-amber-300 cursor-pointer";case"place":return"font-semibold text-violet-400 hover:text-violet-300 cursor-pointer";case"npc":return"font-semibold text-green-300 hover:text-green-200 cursor-pointer";default:return""}},ve=(e,t,o=!1)=>{if(!e)return[e??""];const n=xe(t);if(!n)return[e];const{regex:a,lookup:l}=n,r=[];let c=0,p;for(;(p=a.exec(e))!==null;){const h=p[0],v=l.get(h.toLowerCase());if(p.index>c&&r.push(e.substring(c,p.index)),v){const g=j=>{if(window.matchMedia("(hover: none)").matches){const x=j.currentTarget.getBoundingClientRect(),f=j.currentTarget.getAttribute("title")??"";ge(f,x)}};r.push(s.jsx("span",{className:fe(v.entityData.type),onClick:o?g:void 0,title:v.entityData.description,children:h},`${v.entityData.name}-${v.term}-${String(p.index)}`))}else r.push(h);c=a.lastIndex}return c<e.length&&r.push(e.substring(c)),r.length>0?r:[e]},vt=(e,t,o)=>{const n=e.map(r=>({name:r.name,type:"item",description:r.isActive&&r.activeDescription?r.activeDescription:r.description,item:r})),a=t.map(r=>({name:r.placeName,type:"place",description:r.data.description,aliases:r.data.aliases??[]})),l=o.map(r=>({name:r.name,type:"npc",description:r.description,aliases:r.aliases}));return[...n,...a,...l]},je=["standard","center","compact","toolbar","toolbarLarge","toggle","toggleFull","close","tab"],we=["slate","gray","zinc","neutral","stone","red","orange","amber","yellow","lime","green","emerald","teal","cyan","sky","blue","indigo","violet","purple","fuchsia","pink","rose"];function d({ariaLabel:e,onClick:t,disabled:o=!1,icon:n,label:a,highlightEntities:l,enableHighlightTap:r=!1,pressed:c=!1,size:p="md",title:h,type:v="button",variant:g="standard",preset:j,cost:x,"data-action-name":f,"data-item-id":u,"data-item-name":w,"data-node-id":_,"data-option":y,"data-prompt-effect":b}){const A=m.useCallback(V=>{t(V),V.currentTarget.blur()},[t]),D=g==="standard"||g==="center"||g==="compact"||g==="toggleFull"?{sm:"px-3 py-1 text-sm",md:"px-3 py-2 text-base",lg:"px-3 py-3 text-lg"}[p]:"",S={standard:"w-full flex items-center justify-center",center:"w-full flex items-center text-center",compact:"inline-flex items-center justify-center",toolbar:"flex items-center justify-center w-9 h-9 p-2",toolbarLarge:"flex items-center justify-center w-[4.33rem] h-[4.33rem] p-3",toggle:"inline-flex items-center justify-center px-3 py-1 text-xs",toggleFull:"w-full flex items-center justify-center",close:"animated-frame-close-button",tab:"px-3 py-2 text-sm font-medium transition-colors"},ee={slate:"bg-slate-600 hover:bg-slate-500 focus:ring-slate-400",gray:"bg-gray-700 hover:bg-gray-500 focus:ring-gray-400",zinc:"bg-zinc-700 hover:bg-zinc-500 focus:ring-zinc-400",neutral:"bg-neutral-700 hover:bg-neutral-500 focus:ring-neutral-400",stone:"bg-stone-700 hover:bg-stone-500 focus:ring-stone-400",red:"bg-red-700 hover:bg-red-500 focus:ring-red-400",orange:"bg-orange-700 hover:bg-orange-500 focus:ring-orange-400",amber:"bg-amber-700 hover:bg-amber-500 focus:ring-amber-400",yellow:"bg-yellow-700 hover:bg-yellow-500 focus:ring-yellow-400",lime:"bg-lime-700 hover:bg-lime-500 focus:ring-lime-400",green:"bg-green-700 hover:bg-green-500 focus:ring-green-400",emerald:"bg-emerald-700 hover:bg-emerald-500 focus:ring-emerald-400",teal:"bg-teal-700 hover:bg-teal-500 focus:ring-teal-400",cyan:"bg-cyan-700 hover:bg-cyan-500 focus:ring-cyan-400",sky:"bg-sky-700 hover:bg-sky-500 focus:ring-sky-400",blue:"bg-blue-700 hover:bg-blue-500 focus:ring-blue-400",indigo:"bg-indigo-700 hover:bg-indigo-500 focus:ring-indigo-400",violet:"bg-violet-700 hover:bg-violet-500 focus:ring-violet-400",purple:"bg-purple-700 hover:bg-purple-500 focus:ring-purple-400",fuchsia:"bg-fuchsia-700 hover:bg-fuchsia-500 focus:ring-fuchsia-400",pink:"bg-pink-700 hover:bg-pink-500 focus:ring-pink-400",rose:"bg-rose-700 hover:bg-rose-500 focus:ring-rose-400"},se=(g==="toggle"||g==="toggleFull")&&c?"ring-2 ring-sky-400 ring-offset-1 ring-offset-slate-800":g==="tab"?c?"border-b-2 border-sky-400 text-sky-300":"text-slate-300 hover:text-sky-400 border-b-2 border-transparent":"",z=l&&typeof a=="string"?ve(a,l,r):a;return s.jsxs("button",{"aria-label":e,"aria-pressed":g==="toggle"||g==="toggleFull"?c:void 0,className:`rounded-md shadow transition-colors duration-150 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 ${D} ${S[g]} ${j?ee[j]:""} ${se} ${x!==void 0?"relative":""}`,"data-action-name":f,"data-item-id":u,"data-item-name":w,"data-node-id":_,"data-option":y,"data-prompt-effect":b,disabled:o,onClick:A,title:h,type:v==="submit"?"submit":v==="reset"?"reset":"button",children:[n?s.jsx("span",{className:a?"mr-2 inline-flex":"inline-flex",children:n}):null,z?s.jsx("span",{className:"flex-1 text-shadow-sm text-center",children:z}):null,x!==void 0?s.jsx("span",{className:"absolute right-2 text-xs",children:x}):null]})}d.defaultProps={"data-action-name":void 0,"data-item-id":void 0,"data-item-name":void 0,"data-node-id":void 0,"data-option":void 0,"data-prompt-effect":void 0,cost:void 0,disabled:!1,enableHighlightTap:!1,highlightEntities:void 0,icon:void 0,label:void 0,preset:void 0,pressed:!1,size:"md",title:void 0,type:"button",variant:"standard"};function be({height:e="1em",width:t="1em"}){return s.jsx("svg",{fill:"none",height:e,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M14.25 7.756a4.5 4.5 0 1 0 0 8.488M7.5 10.5h5.25m-5.25 3h5.25M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0",strokeLinecap:"round",strokeLinejoin:"round"})})}function Se({height:e="1em",width:t="1em"}){return s.jsxs("svg",{fill:"none",height:e,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M2.036 12.322a1 1 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0",strokeLinecap:"round",strokeLinejoin:"round"})]})}function Ie({height:e="1em",width:t="1em"}){return s.jsx("svg",{fill:"none",height:e,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M12 6.042A8.97 8.97 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A9 9 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.97 8.97 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A9 9 0 0 0 18 18a8.97 8.97 0 0 0-6-2.292m0 0V3.75m0 16.5V18",strokeLinecap:"round",strokeLinejoin:"round"})})}function Ce({height:e="1em",width:t="1em"}){return s.jsx("svg",{fill:"none",height:e,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5",strokeLinecap:"round",strokeLinejoin:"round"})})}function ye({height:e="1em",width:t="1em"}){return s.jsx("svg",{fill:"none",height:e,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0m-9-3.75h.008v.008H12z",strokeLinecap:"round",strokeLinejoin:"round"})})}function Te({height:e="1em",width:t="1em"}){return s.jsx("svg",{fill:"none",height:e,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9",strokeLinecap:"round",strokeLinejoin:"round"})})}function Ne({height:e="1em",width:t="1em"}){return s.jsxs("svg",{fill:"none",height:e,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M3 20V5l6-2v15zM9 18V3l6 2v15zM15 20V5l6 2v15z",stroke:"currentColor",strokeWidth:1.2}),s.jsx("path",{d:"M9 3v15M15 5v15",stroke:"#b6c2d1",strokeWidth:.8}),s.jsx("path",{d:"M3 20V5l6-2 6 2 6 2v15l-6-2-6-2-6 2",stroke:"currentColor",strokeWidth:1.2})]})}function _e({height:e="1em",width:t="1em"}){return s.jsx("svg",{fill:"currentColor",height:e,viewBox:"0 0 20 20",width:t,xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M5 4a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2zm0 4v10h10V8zm2-2h6V4H7z"})})}function Ee({height:e="1em",width:t="1em"}){return s.jsx("svg",{fill:"none",height:e,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21q.512.078 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48 48 0 0 0-3.478-.397m-12.56 0c1.153 0 2.243.032 3.223.094M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0",strokeLinecap:"round",strokeLinejoin:"round"})})}function Le({height:e="1em",width:t="1em"}){return s.jsx("svg",{fill:"none",height:e,stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5.586a1 1 0 0 1 .707.293l5.414 5.414a1 1 0 0 1 .293.707V19a2 2 0 0 1-2 2",strokeLinecap:"round",strokeLinejoin:"round"})})}function Re({height:e="1em",width:t="1em"}){return s.jsx("svg",{fill:"currentColor",height:e,viewBox:"0 0 20 20",width:t,xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{clipRule:"evenodd",d:"M10 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6m-7 9a7 7 0 1 1 14 0z",fillRule:"evenodd"})})}function Ae({height:e="1em",width:t="1em"}){return s.jsx("svg",{fill:"currentColor",height:e,viewBox:"0 0 20 20",width:t,xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M13 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0m5 2a2 2 0 1 1-4 0 2 2 0 0 1 4 0m-4 7a4 4 0 0 0-8 0v3h8zM6 8a2 2 0 1 1-4 0 2 2 0 0 1 4 0m10 10v-3a6 6 0 0 0-.75-2.906A3.005 3.005 0 0 1 19 15v3zM4.75 12.094A6 6 0 0 0 4 15v3H1v-3a3 3 0 0 1 3.75-2.906"})})}function De({height:e="1em",width:t="1em"}){return s.jsxs("svg",{fill:"none",height:e,stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"m12 3 9 4.5-9 4.5-9-4.5z",fill:"#f8e7c0",strokeLinejoin:"round"}),s.jsx("path",{d:"m3 7.5 9 4.5v9l-9-4.5zM21 7.5 12 12v9l9-4.5z",fill:"#e2c48d",strokeLinejoin:"round"}),s.jsx("path",{d:"m12 3 9 4.5v9L12 21l-9-4.5v-9L12 3",strokeLinejoin:"round"})]})}function Me({height:e="1em",width:t="1em"}){return s.jsxs("svg",{fill:"none",height:e,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("circle",{cx:12,cy:12,r:10,stroke:"currentColor",strokeWidth:2}),s.jsx("circle",{cx:12,cy:12,fill:"currentColor",r:4}),s.jsx("g",{stroke:"currentColor",strokeWidth:2,children:s.jsx("path",{d:"M12 12V2M12 12l8.142 5.071M12 12v10M12 12l-8.142 5.071"})})]})}function Oe({height:e="1em",width:t="1em"}){return s.jsx("svg",{fill:"none",height:e,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M6 18 18 6M6 6l12 12",strokeLinecap:"round",strokeLinejoin:"round"})})}function ke({height:e="1em",width:t="1em"}){return s.jsx("svg",{fill:"none",height:e,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M12 8v4l3 3m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0",strokeLinecap:"round",strokeLinejoin:"round"})})}function $e({height:e="1em",width:t="1em"}){return s.jsx("svg",{fill:"currentColor",height:e,viewBox:"0 0 20 20",width:t,xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{clipRule:"evenodd",d:"M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0m-7 4a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-1-9a1 1 0 0 0-1 1v4a1 1 0 1 0 2 0V6a1 1 0 0 0-1-1",fillRule:"evenodd"})})}function Ue({height:e="1em",width:t="1em"}){return s.jsxs("svg",{fill:"none",height:e,stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M16.862 3.487a1.125 1.125 0 0 1 1.591 1.591l-9 9a1.125 1.125 0 0 1-.433.266L6 15l.656-2.976a1.125 1.125 0 0 1 .266-.433l9-9Z",strokeLinecap:"round",strokeLinejoin:"round"}),s.jsx("path",{d:"M19.5 10.5V18A2.25 2.25 0 0 1 17.25 20.25H6.75A2.25 2.25 0 0 1 4.5 18V6.75A2.25 2.25 0 0 1 6.75 4.5H14.25",strokeLinecap:"round",strokeLinejoin:"round"})]})}const Q={coin:be,visualize:Se,bookOpen:Ie,menu:Ce,info:ye,scroll:Te,map:Ne,inventory:_e,trash:Ee,log:Le,companion:Re,nearbyNpc:Ae,mapItemBox:De,mapWheel:Me,clock:ke,error:$e,x:Oe,journalPen:Ue},Ge=Object.keys(Q);function R({name:e,size:t,color:o,inline:n=!1,marginRight:a,wrapper:l="span"}){const r=Q[e],p=[n?"inline-block":"",o?{slate:"text-slate-400",gray:"text-gray-400",zinc:"text-zinc-400",neutral:"text-neutral-400",stone:"text-stone-400",red:"text-red-400",orange:"text-orange-400",amber:"text-amber-400",yellow:"text-yellow-400",lime:"text-lime-400",green:"text-green-400",emerald:"text-emerald-400",teal:"text-teal-400",cyan:"text-cyan-400",sky:"text-sky-400",blue:"text-blue-400",indigo:"text-indigo-400",violet:"text-violet-400",purple:"text-purple-400",fuchsia:"text-fuchsia-400",pink:"text-pink-400",rose:"text-rose-400",white:"text-white"}[o]:""].filter(Boolean).join(" "),h=a?{marginRight:a}:void 0;return l==="g"?s.jsx("g",{className:p,style:h,children:s.jsx(r,{height:t,width:t})}):s.jsx("span",{className:p,style:h,children:s.jsx(r,{height:t,width:t})})}R.defaultProps={color:void 0,inline:!1,marginRight:void 0,size:void 0,wrapper:"span"};function i({title:e,content:t,isJson:o=!0,maxHeightClass:n="overflow-auto max-h-60"}){const a=(()=>{if(t==null)return"N/A";if(typeof t=="string")return t;if(o)try{const l=G(t);if(e.toLowerCase().includes("parsed")){const r=c=>{c&&typeof c=="object"&&(delete c.observations,delete c.rationale,Object.values(c).forEach(r))};r(l)}return JSON.stringify(l,null,2)}catch(l){return console.error("Error stringifying debug content:",l,t),"Error stringifying JSON content."}return typeof t=="string"?t:JSON.stringify(t,null,2)})();return s.jsxs("section",{className:"mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-sky-400 mb-1",children:e}),s.jsx("pre",{className:`bg-slate-900 p-2 rounded-md text-sm  font-mono text-white overflow-auto ${n} whitespace-pre-wrap break-words`,children:s.jsx("code",{children:a})})]})}i.defaultProps={isJson:!0,maxHeightClass:"overflow-auto max-h-60"};function Je({npcs:e}){return s.jsx(i,{content:e,maxHeightClass:"max-h-[70vh]",title:"Current NPCs"})}const I=e=>{try{return JSON.parse(`"${e.replace(/"/g,'\\"')}"`)}catch{return e.replace(/\\n/g,`
`)}},E=e=>{if(!e)return"";const t=de(e);try{const o=JSON.parse(t),n=a=>{a&&typeof a=="object"&&(delete a.observations,delete a.rationale,Object.values(a).forEach(n))};return n(o),JSON.stringify(o,null,2)}catch{return e.replace(/"?(observations|rationale)"?\s*:\s*"[^"\\]*(?:\\.[^"\\]*)*"\s*,?/gi,"").trim()}};function ze({debugPacket:e}){const[t,o]=m.useState("reqres"),n=m.useCallback(()=>{o("reqres")},[]),a=m.useCallback(()=>{o("insights")},[]),l=m.useCallback(()=>{o("prompt")},[]);return e!=null&&e.dialogueDebugInfo?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[s.jsx(d,{ariaLabel:"Show request and response",label:"Req/Res",onClick:n,preset:t==="reqres"?"sky":"slate",pressed:t==="reqres",size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show insights",label:"Insights",onClick:a,preset:t==="insights"?"sky":"slate",pressed:t==="insights",size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show system prompt",label:"Prompt",onClick:l,preset:t==="prompt"?"sky":"slate",pressed:t==="prompt",size:"sm",variant:"toggle"})]}),t==="reqres"?s.jsx(s.Fragment,{children:e.dialogueDebugInfo.turns.map((r,c)=>{const p=r.thoughts&&r.thoughts.length>0?r.thoughts.map(v=>`Narrator THOUGHTS: "${I(v)}"`).join(`
`):null,h=p?`${p}
${r.rawResponse}`:r.rawResponse;return s.jsxs("div",{className:"mb-2",children:[s.jsx(i,{content:r.prompt,isJson:!1,title:`Turn ${String(c+1)} Request`}),s.jsx(i,{content:h,isJson:!1,title:`Turn ${String(c+1)} Response`})]},r.prompt)})}):t==="insights"?s.jsxs(s.Fragment,{children:[e.dialogueDebugInfo.summaryThoughts&&e.dialogueDebugInfo.summaryThoughts.length>0?s.jsx(i,{content:e.dialogueDebugInfo.summaryThoughts.map(I).join(`
`),isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Dialogue Summary Thoughts"}):null,e.dialogueDebugInfo.summaryPrompt?s.jsx(i,{content:e.dialogueDebugInfo.summaryPrompt,isJson:!1,title:"Dialogue Summary Prompt"}):null,e.dialogueDebugInfo.summaryRawResponse?s.jsx(i,{content:e.dialogueDebugInfo.summaryRawResponse,isJson:!1,title:"Dialogue Summary Response"}):null]}):s.jsxs(s.Fragment,{children:[s.jsx(i,{content:e.dialogueDebugInfo.systemInstruction??"N/A",isJson:!1,title:"System Prompt"}),e.dialogueDebugInfo.jsonSchema?s.jsxs(s.Fragment,{children:[s.jsx(i,{content:e.dialogueDebugInfo.jsonSchema,title:"Raw Schema"}),s.jsx(i,{content:N(e.dialogueDebugInfo.jsonSchema),isJson:!1,title:"Schema as Prompt"})]}):null]})]}):s.jsx("p",{className:"italic text-slate-300",children:"No Dialogue debug info captured."})}function Ve({gameLog:e}){return s.jsx(i,{content:e,maxHeightClass:"max-h-[70vh]",title:"Current Game Log"})}function Z({currentState:e,onUndoTurn:t,onApplyGameState:o,onTriggerMainQuestAchieved:n,previousState:a=void 0}){const[l,r]=m.useState(""),[c,p]=m.useState(null);m.useEffect(()=>{const g=M(e);delete g.lastDebugPacket,r(JSON.stringify(g,null,2))},[e]);const h=m.useCallback(g=>{r(g.target.value),p(null)},[]),v=m.useCallback(()=>{const g=K(l);if(g){const j=G(g);j.inventory=j.inventory.map(x=>{var u;const f=e.inventory.find(w=>w.id===x.id);return f?{...x,chapters:(u=x.chapters)==null?void 0:u.map((w,_)=>{var y,b;return{...w,imageData:(b=(y=f.chapters)==null?void 0:y[_])==null?void 0:b.imageData}})}:x}),j.playerJournal=j.playerJournal.map((x,f)=>{var u;return{...x,imageData:(u=e.playerJournal[f])==null?void 0:u.imageData}}),o(j),p(null)}else p("Invalid JSON")},[l,o,e]);return s.jsxs(s.Fragment,{children:[s.jsx(d,{ariaLabel:"Undo last turn",disabled:!a||e.globalTurnNumber<=1,label:`Undo Turn (Global Turn: ${String(e.globalTurnNumber)})`,onClick:t,preset:"orange",size:"sm",variant:"compact"}),s.jsx(d,{ariaLabel:"Trigger main quest achieved",label:"Main Quest Achieved",onClick:n,preset:"purple",size:"sm",variant:"compact"}),s.jsxs("div",{className:"my-2",children:[s.jsx("label",{className:"block text-sm text-amber-300 mb-1",htmlFor:"gameStateEdit",children:"Edit Game State"}),s.jsx("textarea",{className:"w-full p-2 bg-slate-900 text-white border border-slate-600 rounded-md text-sm min-h-[40em] font-mono",id:"gameStateEdit",onChange:h,value:l}),s.jsx(d,{ariaLabel:"Verify and apply edited game state",label:"Verify & Apply",onClick:v,preset:"green",size:"sm",variant:"compact"}),c?s.jsx("p",{className:"text-red-400 text-xs mt-1",children:c}):null]}),s.jsx(i,{content:M(e),maxHeightClass:"max-h-[30vh]",title:"Current Game State (Stack[0] - Top)"}),a?s.jsx(i,{content:(()=>{const g=M(a);return delete g.lastDebugPacket,g})(),maxHeightClass:"max-h-[30vh]",title:"Previous Game State (Stack[1] - Bottom)"}):null]})}Z.defaultProps={previousState:void 0};function Fe({debugPacket:e}){const[t,o]=m.useState(!0),[n,a]=m.useState("reqres"),l=m.useCallback(()=>{o(!0)},[]),r=m.useCallback(()=>{o(!1)},[]),c=m.useCallback(()=>{a("reqres")},[]),p=m.useCallback(()=>{a("insights")},[]),h=m.useCallback(()=>{a("prompt")},[]);return e!=null&&e.inventoryDebugInfo?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[s.jsx(d,{ariaLabel:"Show request and response",label:"Req/Res",onClick:c,preset:n==="reqres"?"sky":"slate",pressed:n==="reqres",size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show insights",label:"Insights",onClick:p,preset:n==="insights"?"sky":"slate",pressed:n==="insights",size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show system prompt",label:"Prompt",onClick:h,preset:n==="prompt"?"sky":"slate",pressed:n==="prompt",size:"sm",variant:"toggle"})]}),n==="reqres"?s.jsxs(s.Fragment,{children:[s.jsx(i,{content:e.inventoryDebugInfo.prompt,isJson:!1,title:"Inventory AI Request"}),s.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[s.jsx(d,{ariaLabel:"Show raw inventory response",label:"Raw",onClick:l,preset:t?"sky":"slate",pressed:t,size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show parsed inventory response",label:"Parsed",onClick:r,preset:t?"slate":"sky",pressed:!t,size:"sm",variant:"toggle"})]}),t?s.jsx(i,{content:E(e.inventoryDebugInfo.rawResponse),isJson:!1,title:"Inventory AI Response Raw"}):s.jsx(i,{content:e.inventoryDebugInfo.parsedItemChanges,title:"Inventory AI Response Parsed"})]}):n==="insights"?s.jsxs(s.Fragment,{children:[e.inventoryDebugInfo.thoughts&&e.inventoryDebugInfo.thoughts.length>0?s.jsx(i,{content:e.inventoryDebugInfo.thoughts.map(I).join(`
`),isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Inventory Thoughts"}):null,e.inventoryDebugInfo.observations?s.jsx(i,{content:e.inventoryDebugInfo.observations,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Inventory Observations"}):null,e.inventoryDebugInfo.rationale?s.jsx(i,{content:e.inventoryDebugInfo.rationale,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Inventory Rationale"}):null]}):s.jsxs(s.Fragment,{children:[s.jsx(i,{content:e.inventoryDebugInfo.systemInstruction??"N/A",isJson:!1,title:"System Prompt"}),e.inventoryDebugInfo.jsonSchema?s.jsxs(s.Fragment,{children:[s.jsx(i,{content:e.inventoryDebugInfo.jsonSchema,title:"Raw Schema"}),s.jsx(i,{content:N(e.inventoryDebugInfo.jsonSchema),isJson:!1,title:"Schema as Prompt"})]}):null]})]}):s.jsx("p",{className:"italic text-slate-300",children:"No Inventory AI interaction debug packet captured."})}function qe({debugPacket:e}){const[t,o]=m.useState(!0),[n,a]=m.useState("reqres"),l=m.useCallback(()=>{o(!0)},[]),r=m.useCallback(()=>{o(!1)},[]),c=m.useCallback(()=>{a("reqres")},[]),p=m.useCallback(()=>{a("insights")},[]),h=m.useCallback(()=>{a("prompt")},[]);return e!=null&&e.librarianDebugInfo?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[s.jsx(d,{ariaLabel:"Show request and response",label:"Req/Res",onClick:c,preset:n==="reqres"?"sky":"slate",pressed:n==="reqres",size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show insights",label:"Insights",onClick:p,preset:n==="insights"?"sky":"slate",pressed:n==="insights",size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show system prompt",label:"Prompt",onClick:h,preset:n==="prompt"?"sky":"slate",pressed:n==="prompt",size:"sm",variant:"toggle"})]}),n==="reqres"?s.jsxs(s.Fragment,{children:[s.jsx(i,{content:e.librarianDebugInfo.prompt,isJson:!1,title:"Librarian AI Request"}),s.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[s.jsx(d,{ariaLabel:"Show raw inventory response",label:"Raw",onClick:l,preset:t?"sky":"slate",pressed:t,size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show parsed inventory response",label:"Parsed",onClick:r,preset:t?"slate":"sky",pressed:!t,size:"sm",variant:"toggle"})]}),t?s.jsx(i,{content:E(e.librarianDebugInfo.rawResponse),isJson:!1,title:"Librarian AI Response Raw"}):s.jsx(i,{content:e.librarianDebugInfo.parsedItemChanges,title:"Librarian AI Response Parsed"})]}):n==="insights"?s.jsxs(s.Fragment,{children:[e.librarianDebugInfo.thoughts&&e.librarianDebugInfo.thoughts.length>0?s.jsx(i,{content:e.librarianDebugInfo.thoughts.map(I).join(`
`),isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Librarian Thoughts"}):null,e.librarianDebugInfo.observations?s.jsx(i,{content:e.librarianDebugInfo.observations,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Librarian Observations"}):null,e.librarianDebugInfo.rationale?s.jsx(i,{content:e.librarianDebugInfo.rationale,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Librarian Rationale"}):null]}):s.jsxs(s.Fragment,{children:[s.jsx(i,{content:e.librarianDebugInfo.systemInstruction??"N/A",isJson:!1,title:"System Prompt"}),e.librarianDebugInfo.jsonSchema?s.jsxs(s.Fragment,{children:[s.jsx(i,{content:e.librarianDebugInfo.jsonSchema,title:"Raw Schema"}),s.jsx(i,{content:N(e.librarianDebugInfo.jsonSchema),isJson:!1,title:"Schema as Prompt"})]}):null]})]}):s.jsx("p",{className:"italic text-slate-300",children:"No Librarian AI interaction debug packet captured."})}function He({inventory:e}){return s.jsx(i,{content:e,maxHeightClass:"max-h-[70vh]",title:"Current Inventory"})}function Be({debugPacket:e}){const[t,o]=m.useState(!0),[n,a]=m.useState("reqres"),l=m.useCallback(()=>{o(!0)},[]),r=m.useCallback(()=>{o(!1)},[]),c=m.useCallback(()=>{a("reqres")},[]),p=m.useCallback(()=>{a("insights")},[]),h=m.useCallback(()=>{a("prompt")},[]),v=e!=null&&e.timestamp?new Date(e.timestamp).toLocaleString():"N/A";return s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"text-sm text-slate-300 mb-2",children:["Timestamp:",v]}),s.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[s.jsx(d,{ariaLabel:"Show request and response",label:"Req/Res",onClick:c,preset:n==="reqres"?"sky":"slate",pressed:n==="reqres",size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show insights",label:"Insights",onClick:p,preset:n==="insights"?"sky":"slate",pressed:n==="insights",size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show system prompt",label:"Prompt",onClick:h,preset:n==="prompt"?"sky":"slate",pressed:n==="prompt",size:"sm",variant:"toggle"})]}),n==="reqres"?s.jsxs(s.Fragment,{children:[s.jsx(i,{content:e==null?void 0:e.prompt,isJson:!1,title:"Last Storyteller AI Request"}),s.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[s.jsx(d,{ariaLabel:"Show raw response",label:"Raw",onClick:l,preset:t?"sky":"slate",pressed:t,size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show parsed response",label:"Parsed",onClick:r,preset:t?"slate":"sky",pressed:!t,size:"sm",variant:"toggle"})]}),t?s.jsx(i,{content:e==null?void 0:e.rawResponseText,isJson:!1,title:"Storyteller AI Response Raw"}):s.jsx(i,{content:e==null?void 0:e.parsedResponse,title:"Storyteller AI Response Parsed "})]}):n==="insights"?e!=null&&e.storytellerThoughts&&e.storytellerThoughts.length>0?s.jsx(i,{content:e.storytellerThoughts.map(I).join(`
`),isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Storyteller Thoughts"}):null:s.jsxs(s.Fragment,{children:[s.jsx(i,{content:(e==null?void 0:e.systemInstruction)??"N/A",isJson:!1,title:"System Prompt"}),e!=null&&e.jsonSchema?s.jsxs(s.Fragment,{children:[s.jsx(i,{content:e.jsonSchema,title:"Raw Schema"}),s.jsx(i,{content:N(e.jsonSchema),isJson:!1,title:"Schema as Prompt"})]}):null]}),e!=null&&e.error?s.jsx(i,{content:e.error,isJson:!1,title:"Error During Storyteller AI Interaction"}):null]})}function We({mapData:e}){return s.jsx(i,{content:e,maxHeightClass:"max-h-[70vh]",title:"Current Map Data (Full)"})}function Ye({themeFacts:e}){const t=[...e].sort((o,n)=>n.tier-o.tier||n.createdTurn-o.createdTurn).map((o,n)=>`${String(n+1)}. (Tier ${String(o.tier)}) ${o.text}`).join(`
`);return s.jsx(i,{content:t,isJson:!1,maxHeightClass:"max-h-[70vh]",title:"Current Theme Lore"})}function Xe({debugPacket:e}){const[t,o]=m.useState(!0),[n,a]=m.useState({}),[l,r]=m.useState("reqres"),c=m.useCallback(()=>{o(!0)},[]),p=m.useCallback(()=>{o(!1)},[]),h=m.useCallback(()=>{r("reqres")},[]),v=m.useCallback(()=>{r("insights")},[]),g=m.useCallback(()=>{r("prompt")},[]),j=m.useCallback(u=>()=>{a(w=>({...w,[u]:!0}))},[]),x=m.useCallback(u=>()=>{a(w=>({...w,[u]:!1}))},[]),f=e!=null&&e.timestamp?new Date(e.timestamp).toLocaleString():"N/A";return s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"text-sm text-slate-300 mb-2",children:["Map Update related to interaction at:",f]}),e!=null&&e.mapUpdateDebugInfo?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[s.jsx(d,{ariaLabel:"Show request and response",label:"Req/Res",onClick:h,preset:l==="reqres"?"sky":"slate",pressed:l==="reqres",size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show insights",label:"Insights",onClick:v,preset:l==="insights"?"sky":"slate",pressed:l==="insights",size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show system prompt",label:"Prompt",onClick:g,preset:l==="prompt"?"sky":"slate",pressed:l==="prompt",size:"sm",variant:"toggle"})]}),l==="reqres"?s.jsxs(s.Fragment,{children:[s.jsx(i,{content:e.mapUpdateDebugInfo.prompt,isJson:!1,title:"Cartographer AI Request"}),s.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[s.jsx(d,{ariaLabel:"Show raw map response",label:"Raw",onClick:c,preset:t?"sky":"slate",pressed:t,size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show parsed map response",label:"Parsed",onClick:p,preset:t?"slate":"sky",pressed:!t,size:"sm",variant:"toggle"})]}),t?s.jsx(i,{content:E(e.mapUpdateDebugInfo.rawResponse),isJson:!1,title:"Cartographer AI Response Raw"}):s.jsx(i,{content:e.mapUpdateDebugInfo.parsedPayload,title:"Cartographer AI Response Parsed"})]}):l==="insights"?s.jsxs(s.Fragment,{children:[e.mapUpdateDebugInfo.thoughts&&e.mapUpdateDebugInfo.thoughts.length>0?s.jsx(i,{content:e.mapUpdateDebugInfo.thoughts.map(I).join(`
`),isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Cartographer Thoughts"}):null,e.mapUpdateDebugInfo.observations?s.jsx(i,{content:e.mapUpdateDebugInfo.observations,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Cartographer Observations"}):null,e.mapUpdateDebugInfo.rationale?s.jsx(i,{content:e.mapUpdateDebugInfo.rationale,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:"Cartographer Rationale"}):null]}):s.jsxs(s.Fragment,{children:[s.jsx(i,{content:e.mapUpdateDebugInfo.systemInstruction??"N/A",isJson:!1,title:"System Prompt"}),e.mapUpdateDebugInfo.jsonSchema?s.jsxs(s.Fragment,{children:[s.jsx(i,{content:e.mapUpdateDebugInfo.jsonSchema,title:"Raw Schema"}),s.jsx(i,{content:N(e.mapUpdateDebugInfo.jsonSchema),isJson:!1,title:"Schema as Prompt"})]}):null]}),e.mapUpdateDebugInfo.validationError?s.jsx(i,{content:e.mapUpdateDebugInfo.validationError,isJson:!1,title:"Map Update Validation Error"}):null,e.mapUpdateDebugInfo.minimalModelCalls?s.jsx(i,{content:e.mapUpdateDebugInfo.minimalModelCalls,title:"Minimal Model Calls"}):null,e.mapUpdateDebugInfo.connectorChainsDebugInfo&&e.mapUpdateDebugInfo.connectorChainsDebugInfo.length>0?e.mapUpdateDebugInfo.connectorChainsDebugInfo.map((u,w)=>s.jsxs("div",{className:"my-2",children:[l==="reqres"?s.jsxs(s.Fragment,{children:[s.jsx(i,{content:u.prompt,isJson:!1,title:`Connector Chains Prompt (Round ${String(u.round)})`}),s.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[s.jsx(d,{ariaLabel:"Show raw connector chain response",label:"Raw",onClick:j(w),preset:n[w]??!0?"sky":"slate",pressed:n[w]??!0,size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show parsed connector chain response",label:"Parsed",onClick:x(w),preset:n[w]??!0?"slate":"sky",pressed:!(n[w]??!0),size:"sm",variant:"toggle"})]}),n[w]??!0?u.rawResponse&&s.jsx(i,{content:E(u.rawResponse),isJson:!1,title:`Connector Chains Raw Response (Round ${String(u.round)})`}):u.parsedPayload&&s.jsx(i,{content:u.parsedPayload,title:`Connector Chains Parsed Payload (Round ${String(u.round)})`})]}):l==="insights"?s.jsxs(s.Fragment,{children:[u.thoughts&&u.thoughts.length>0?s.jsx(i,{content:u.thoughts.map(I).join(`
`),isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:`Connector Chains Thoughts (Round ${String(u.round)})`}):null,u.observations?s.jsx(i,{content:u.observations,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:`Connector Chains Observations (Round ${String(u.round)})`}):null,u.rationale?s.jsx(i,{content:u.rationale,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:`Connector Chains Rationale (Round ${String(u.round)})`}):null]}):null,u.validationError?s.jsx(i,{content:u.validationError,isJson:!1,title:`Connector Chains Validation Error (Round ${String(u.round)})`}):null]},`chain-${String(u.round)}`)):null]}):s.jsx("p",{className:"italic text-slate-300",children:"No Map Update AI interaction debug packet captured for the last main AI turn."})]})}function Ke({debugPacket:e,onDistillFacts:t}){const[o,n]=m.useState({}),[a,l]=m.useState("reqres"),r=m.useCallback(x=>()=>{n(f=>({...f,[x]:!0}))},[]),c=m.useCallback(x=>()=>{n(f=>({...f,[x]:!1}))},[]),p=m.useCallback(()=>{l("reqres")},[]),h=m.useCallback(()=>{l("insights")},[]),v=m.useCallback(()=>{l("prompt")},[]),g=(x,f)=>{if(!f)return null;const u=o[x]??!0;return s.jsx("div",{className:"mb-4",children:a==="reqres"?s.jsxs(s.Fragment,{children:[s.jsx(i,{content:f.prompt,isJson:!1,title:`${x} Request`}),s.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[s.jsx(d,{ariaLabel:`Show raw ${x} response`,label:"Raw",onClick:r(x),preset:u?"sky":"slate",pressed:u,size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:`Show parsed ${x} response`,label:"Parsed",onClick:c(x),preset:u?"slate":"sky",pressed:!u,size:"sm",variant:"toggle"})]}),u?s.jsx(i,{content:E(f.rawResponse),isJson:!1,title:`${x} Response Raw`}):s.jsx(i,{content:f.parsedPayload,title:`${x} Response Parsed`})]}):a==="insights"?s.jsxs(s.Fragment,{children:[f.thoughts&&f.thoughts.length>0?s.jsx(i,{content:f.thoughts.map(I).join(`
`),isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:`${x} Thoughts`}):null,f.observations?s.jsx(i,{content:f.observations,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:`${x} Observations`}):null,f.rationale?s.jsx(i,{content:f.rationale,isJson:!1,maxHeightClass:"overflow-visible max-h-fit",title:`${x} Rationale`}):null]}):s.jsxs(s.Fragment,{children:[s.jsx(i,{content:f.systemInstruction??"N/A",isJson:!1,title:`${x} System Prompt`}),f.jsonSchema?s.jsxs(s.Fragment,{children:[s.jsx(i,{content:f.jsonSchema,title:"Raw Schema"}),s.jsx(i,{content:N(f.jsonSchema),isJson:!1,title:"Schema as Prompt"})]}):null]})},x)},j=e==null?void 0:e.loremasterDebugInfo;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"my-2 flex flex-wrap gap-2",children:[s.jsx(d,{ariaLabel:"Show request and response",label:"Req/Res",onClick:p,preset:a==="reqres"?"sky":"slate",pressed:a==="reqres",size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show insights",label:"Insights",onClick:h,preset:a==="insights"?"sky":"slate",pressed:a==="insights",size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Show system prompt",label:"Prompt",onClick:v,preset:a==="prompt"?"sky":"slate",pressed:a==="prompt",size:"sm",variant:"toggle"})]}),s.jsx(d,{ariaLabel:"Trigger distill mode",label:"Run Distill",onClick:t,preset:"purple",size:"sm",variant:"compact"}),j?s.jsxs(s.Fragment,{children:[g("Collect",j.collect),g("Extract",j.extract),g("Integrate",j.integrate),g("Distill",j.distill),g("Journal",j.journal)]}):s.jsx("p",{className:"italic text-slate-300",children:"No Loremaster AI interaction debug packet captured."})]})}function Qe({currentState:e}){var t;return s.jsx(i,{content:{currentMapNodeId:e.currentMapNodeId,currentObjective:e.currentObjective,currentThemeName:((t=e.currentTheme)==null?void 0:t.name)??null,globalTurnNumber:e.globalTurnNumber,lastTurnChangesBrief:e.lastTurnChanges?{npcs:e.lastTurnChanges.npcChanges.length,items:e.lastTurnChanges.itemChanges.length,mapChanged:e.lastTurnChanges.mapDataChanged,objAchieved:e.lastTurnChanges.objectiveAchieved,mainQuestAchieved:e.lastTurnChanges.mainQuestAchieved}:null,localEnvironment:e.localEnvironment,localPlace:e.localPlace,localTime:e.localTime,mainQuest:e.mainQuest,objectiveAnimationType:e.objectiveAnimationType,score:e.score},maxHeightClass:"max-h-[70vh]",title:"Miscellaneous State Values"})}function P({mapData:e,travelPath:t}){if(!t||t.length===0)return s.jsx("p",{className:"italic text-slate-300",children:"No destination set."});const o=t.map(n=>{if(n.step==="node")return{step:"node",data:e.nodes.find(r=>r.id===n.id)??{id:n.id,missing:!0}};if(n.id.startsWith("hierarchy:")){const[l,r]=n.id.split(":")[1].split("->");return{step:"hierarchy",from:l,to:r}}return{step:"edge",data:e.edges.find(l=>l.id===n.id)??{id:n.id,missing:!0}}});return s.jsxs(s.Fragment,{children:[s.jsx(i,{content:t,title:"Travel Path (IDs)"}),s.jsx(i,{content:o,maxHeightClass:"max-h-[70vh]",title:"Expanded Path Data"})]})}P.defaultProps={travelPath:null};const O=[...we],Ze=[...je],Pe=[...Ge],H=U.filter(e=>!C.includes(e)&&e!=="glitching");function es(){const[e,t]=m.useState(new Set),o=m.useCallback(a=>()=>{t(l=>{const r=new Set(l);return r.has(a)?r.delete(a):r.add(a),r})},[]),n=m.useCallback(()=>{},[]);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("section",{children:[s.jsx("h3",{className:"text-lg text-slate-300 mb-2",children:"Buttons"}),Ze.map(a=>{const l=a==="toggle",r=a==="close",c=r?O.slice(0,1):O;return s.jsxs("div",{className:"mb-4",children:[s.jsx("h4",{className:"text-slate-400 mb-1",children:a}),s.jsx("div",{className:`flex flex-wrap gap-1${r?" relative h-12":""}`,children:c.map(p=>{const h=`${String(a)}-${p}`;return s.jsx(d,{ariaLabel:h,icon:r?s.jsx(R,{name:"x",size:16}):void 0,label:r?void 0:p,onClick:l?o(h):n,preset:p,pressed:l?e.has(h):void 0,size:"sm",variant:a},h)})})]},a)})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-lg text-slate-300 mb-2",children:"Text Fields"}),s.jsx("div",{className:"grid grid-cols-2 gap-3",children:O.slice(0,8).map(a=>s.jsx("input",{"aria-label":a,className:`p-2 rounded-md bg-${a}-700 text-${a}-200 border border-${a}-500`,placeholder:a,readOnly:!0},a))})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-lg text-slate-300 mb-2",children:"Page Blocks"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-3",children:[C.map(a=>s.jsx("div",{className:`p-3 tag-${a} rounded-md`,children:a},a)),C.flatMap(a=>H.map(l=>s.jsx("div",{className:`p-3 tag-${a} tag-${l} rounded-md`,children:`${a} ${l}`},`${a}-${l}`)))]}),s.jsxs("div",{className:"space-y-3",children:[C.map(a=>s.jsx("div",{className:`p-3 tag-${a} tag-recovered rounded-md`,children:`${a} recovered`},`${a}-recovered`)),C.flatMap(a=>H.map(l=>s.jsx("div",{className:`p-3 tag-${a} tag-${l} tag-recovered rounded-md`,children:`${a} ${l} recovered`},`${a}-${l}-recovered`)))]})]})]}),s.jsxs("section",{children:[s.jsx("h3",{className:"text-lg text-slate-300 mb-2",children:"Icons"}),s.jsx("div",{className:"flex flex-wrap gap-3",children:Pe.map(a=>s.jsxs("div",{className:"flex flex-col items-center text-slate-300",children:[s.jsx(R,{name:a,size:32}),s.jsx("span",{className:"text-xs mt-1",children:a})]},a))})]})]})}function ss({badFacts:e,debugLore:t,goodFacts:o,onClearFacts:n,onSaveFacts:a,onSimulateVictory:l,onToggleDebugLore:r}){const[c,p]=m.useState(!1),h=m.useCallback(()=>{p(j=>!j)},[]),v=m.useCallback(()=>{const j=JSON.stringify({goodFacts:o,badFacts:e},null,2);a(j)},[o,e,a]),g=m.useCallback(()=>{n()},[n]);return s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold text-sky-300 mb-2",children:"Debug Lore"}),s.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[s.jsx(d,{ariaLabel:"Toggle Debug Lore",label:t?"Disable":"Enable",onClick:r,preset:"purple",pressed:t,size:"sm",variant:"toggle"}),s.jsx(d,{ariaLabel:"Simulate victory",label:"Simulate Victory",onClick:l,preset:"green",size:"sm",variant:"compact"}),s.jsx(d,{ariaLabel:"View collected facts",label:c?"Hide Facts":"View Facts",onClick:h,preset:"sky",size:"sm",variant:"compact"}),c?s.jsx(d,{ariaLabel:"Save facts to file",label:"Save JSON",onClick:v,preset:"green",size:"sm",variant:"compact"}):null,c?s.jsx(d,{ariaLabel:"Clear collected facts",label:"Clear Facts",onClick:g,preset:"red",size:"sm",variant:"compact"}):null]}),c?s.jsx(i,{content:{goodFacts:o,badFacts:e},title:"Collected Facts"}):null]})}function jt({isVisible:e,onClose:t,debugPacket:o,gameStateStack:n,onUndoTurn:a,onApplyGameState:l,onTriggerMainQuestAchieved:r,onSimulateVictory:c,travelPath:p,onDistillFacts:h,debugLore:v,onToggleDebugLore:g,goodFacts:j,badFacts:x,onSaveFacts:f,onClearFacts:u}){const[w,_]=m.useState("GameState"),y=m.useCallback(S=>()=>{_(S)},[]);if(!e)return null;const b=n[0],A=n[1],J=[{name:"GameState",label:"Game State"},{name:"MainAI",label:"Storyteller AI"},{name:"MapLocationAI",label:"Cartographer AI"},{name:"InventoryAI",label:"Inventory AI"},{name:"LibrarianAI",label:"Librarian AI"},{name:"LoremasterAI",label:"Loremaster AI"},{name:"DialogueAI",label:"Dialogue AI"},{name:"Inventory",label:"Inventory"},{name:"NPCs",label:"NPCs"},{name:"MapDataFull",label:"Map Data"},{name:"Lore",label:"Lore"},{name:"GameLog",label:"Game Log"},{name:"TravelPath",label:"Travel Path"},{name:"MiscState",label:"Misc State"},{name:"Playground",label:"Playground"},{name:"Settings",label:"Settings"}],D=()=>{switch(w){case"GameState":return s.jsx(Z,{currentState:b,onApplyGameState:l,onTriggerMainQuestAchieved:r,onUndoTurn:a,previousState:A});case"MainAI":return s.jsx(Be,{debugPacket:o});case"MapLocationAI":return s.jsx(Xe,{debugPacket:o});case"InventoryAI":return s.jsx(Fe,{debugPacket:o});case"LibrarianAI":return s.jsx(qe,{debugPacket:o});case"LoremasterAI":return s.jsx(Ke,{debugPacket:o,onDistillFacts:h});case"DialogueAI":return s.jsx(ze,{debugPacket:o});case"Inventory":return s.jsx(He,{inventory:b.inventory});case"NPCs":return s.jsx(Je,{npcs:b.allNPCs});case"MapDataFull":return s.jsx(We,{mapData:b.mapData});case"Lore":return s.jsx(Ye,{themeFacts:b.themeFacts});case"GameLog":return s.jsx(Ve,{gameLog:b.gameLog});case"TravelPath":return s.jsx(P,{mapData:b.mapData,travelPath:p});case"MiscState":return s.jsx(Qe,{currentState:b});case"Playground":return s.jsx(es,{});case"Settings":return s.jsx(ss,{badFacts:x,debugLore:v,goodFacts:j,onClearFacts:u,onSaveFacts:f,onSimulateVictory:c,onToggleDebugLore:g});default:return s.jsx("p",{children:"Select a tab"})}};return s.jsx("div",{"aria-labelledby":"debug-view-title","aria-modal":"true",className:"animated-frame open",role:"dialog",children:s.jsxs("div",{className:"animated-frame-content flex flex-col",children:[s.jsx(d,{ariaLabel:"Close debug view",icon:s.jsx(R,{name:"x",size:20}),onClick:t,size:"sm",variant:"close"}),s.jsx("h1",{className:"text-2xl font-bold text-amber-400 mb-3 text-center flex-shrink-0",id:"debug-view-title",children:"Debug View & Game Internals"}),s.jsx("div",{className:"flex flex-wrap border-b border-slate-700 mb-3 flex-shrink-0",children:J.map(S=>s.jsx(d,{ariaLabel:S.label,label:S.label,onClick:y(S.name),pressed:w===S.name,size:"sm",variant:"tab"},S.name))}),s.jsx("div",{className:"overflow-y-auto flex-grow p-1",children:D()})]})})}export{ae as $,xt as A,de as B,fs as C,Is as D,C as E,Y as F,as as G,U as H,ut as I,Zs as J,me as K,bs as L,$s as M,tt as N,he as O,Cs as P,pe as Q,Js as R,gt as S,qs as T,X as U,ce as V,Gs as W,Qs as X,Ks as Y,Ps as Z,et as _,nt as a,Vs as a0,ft as a1,pt as a2,ht as a3,dt as a4,mt as a5,Ys as a6,ds as a7,W as a8,Fs as a9,rt as aA,at as aB,Ns as aC,jt as aD,Ms as aE,B as aa,Hs as ab,us as ac,ks as ad,_s as ae,xe as af,Es as ag,ys as ah,Ls as ai,Rs as aj,As as ak,Ds as al,F as am,q as an,ws as ao,js as ap,Ss as aq,vs as ar,ve as as,vt as at,d as au,R as av,Os as aw,xs as ax,te as ay,gs as az,ct as b,lt as c,it as d,ot as e,Bs as f,Us as g,rs as h,ns as i,N as j,ps as k,os as l,hs as m,ms as n,cs as o,ls as p,Xs as q,Ts as r,G as s,zs as t,ne as u,ie as v,st as w,Ws as x,is as y,K as z};
